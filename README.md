# Tor HTTP Proxy

HTTP прокси-сервер с автоматической балансировкой нагрузки через множественные Tor инстансы.

Нативная реализация на Python работает эффективнее Docker-решений при тех же ресурсах.

## Компоненты

- **HAProxy Load Balancer** — готовый балансировщик, автоматически настраиваемый под активные Tor-инстансы
- **Tor Parallel Runner** — параллельный запуск и мониторинг Tor процессов
- **Tor↔HAProxy Integrator** — координация жизненного цикла и синхронизация конфигураций

## Архитектура

```
HTTP Client → HAProxy SOCKS5 Frontend:9999 → Tor Instances:10000+ → Internet
```

## Установка

```bash
git clone <repository>
cd rotating-tor-http-proxy
sudo ./install_ubuntu.sh
```

## Использование

### HAProxy + Tor пул
```bash
python src/main.py --tor-count 5 --frontend-port 9999
```

Скрипт запускает указанный пул Tor-процессов, ждёт их успешного старта, собирает доступные порты и формирует конфигурацию `haproxy.cfg`. После проверки конфигурации HAProxy поднимается автоматически.

```bash
curl --proxy socks5h://127.0.0.1:9999 https://httpbin.org/ip
```

### Параллельный запуск Tor процессов
Запуск происходит параллельно (параметр `--tor-count`), конфигурация HAProxy пересобирается по мере изменения пула.

### Тестирование параллельного запуска
```bash
python test_parallel_startup.py
```

### Управление через systemd
```bash
sudo systemctl start tor-http-proxy
sudo systemctl stop tor-http-proxy
sudo systemctl status tor-http-proxy
```

## Порты

- **9999 (по умолчанию)** — SOCKS5 фронтенд HAProxy
- **8404 (по умолчанию)** — веб-интерфейс статистики HAProxy
- **10000+** — порты Tor-инстансов (подбираются динамически)

## Производительность

### Параллельный запуск
- **Последовательный запуск**: ~2-3 секунды на процесс
- **Параллельный запуск (10 процессов)**: ~10-15 секунд для 50 процессов
- **Ускорение**: в 3-5 раз быстрее

### Ограничения
- Максимум 10 одновременно запускаемых Tor процессов
- Автоматическое перераспределение узлов при сбоях
- Мониторинг здоровья процессов

## Логи

```bash
journalctl -u tor-http-proxy -f
```